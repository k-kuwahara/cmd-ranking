#!/usr/bin/env node
'use strict';

var exec = require('child_process').execSync;

var number = process.argv[2] || 10;
var REST_CMD = 'sort | uniq -c | sort -r | head -n ' + number;

// get current shell
var get_sh_cmd = 'echo $0 ';
var shell = exec(get_sh_cmd).toString() || 'bash';
// .replace(/[\n\r]/g, '')

console.info(get_sh_cmd);
console.info(shell);

// get rank command
var get_rank_cmd = '';
switch (shell) {
   case 'zsh':
      get_rank_cmd = 'cat ~/.zsh_history | sed -e \'s/.*;//\' | awk \'{print $1}\' | ' + REST_CMD;
      break;
   case 'bash':
   default:
      get_rank_cmd = 'cat ~/.bash_history | ' + REST_CMD;
      break;
}

console.info(get_rank_cmd);
// get history ranking
var rank = exec(get_rank_cmd, function (err, stdout, stderr) {
   if (err) {
      console.error('exec error: ' + err);
      return;
   }
   if (stderr) {
      console.log(stderr);
      return;
   }
}).toString();

console.info(rank);